{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>2017 대선닷컴</title>

    <!-- Font CSS -->
    <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}" type="text/css">
    <link rel='stylesheet' href="{% static 'css/nanumbarungothic.css' %}" type='text/css'>
    <link rel='stylesheet' href='http://fonts.googleapis.com/earlyaccess/nanumpenscript.css' type='text/css'>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{% static 'lib/bootstrap/dist/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'lib/bootstrap/dist/css/bootstrap-theme.min.css' %}">
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">

    <!-- Library CSS -->
    <link rel="stylesheet" href="{% static 'css/waitMe.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/animate.css' %}">
    <link rel="stylesheet" href="{% static 'css/jquery.bracket.min.css' %}">
    <link rel="stylesheet" href="{% static 'lib/c3/c3.min.css' %}">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">

    <!-- Jquery -->
    <script src="{% static 'lib/jquery/dist/jquery.min.js' %}"></script>
    <script src="{% static 'lib/jquery-ui/jquery-ui.min.js' %}"></script>

    <!-- Bootstrap JS -->
    <script src="{% static 'lib/bootstrap/dist/js/bootstrap.min.js' %}"></script>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>

    <!-- Library -->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js"></script>-->
    <script src="{% static 'js/waitMe.min.js' %}"></script>
    <script src="{% static 'js/jquery.bracket.min.js'%}"></script>
    <script src="{% static 'lib/d3/d3.min.js' %}"></script>
    <script src="{% static 'lib/c3/c3.min.js' %}"></script>
</head>

<body id="page-top">
    <nav id="mainNav" class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span> 메뉴 <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand page-scroll" href="#page-top">2017 대선닷컴</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li class="hidden">
                        <a href="#page-top"></a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#rating">지지율</a>
                    </li>
                     <li>
                        <a class="page-scroll" href="#pledge">공약</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#lucky">럭키박스</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#press">언론</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#cheering">응원메세지</a>
                    </li>
                    <li>
                        <a class="page-scroll" href="#donate">기부하기</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <header>
        <div class="container">
            <div class="intro-text">
                <div class="intro-lead-in">대한민국의 미래를 책임질 대통령</div>
                <div class="intro-heading">당신은 누구를 고르시습니까?</div>
                <div class="intro-guide">
                    2017대선닷컴은 특정 후보를 지지하지 않습니다.<br>
                    본 사이트의 모든 콘텐츠는 오직 <strong>재미</strong>를 위해 만들어 졌습니다.
                </div>
            </div>
        </div>
    </header>

    <div id="calendar" class="container">
        <div class="row">
            대선 중요 일정 여기에
        </div>
    </div>

    <section id="rating">
        <div class="container">
            <div class="row">
                <div class="col-md-3 text-center">
                    .
                </div>
                <div class="col-md-6 text-center">
                    <h2 class="section-heading">지지율</h2>
                    <h3 class="section-subheading text-muted">여론조사 / 우주의기운이 돕는 지지율입니다</h3>
                </div>
                <div class="col-md-3 text-center input-group">
                    <input id="rating-toggle" type="checkbox" checked data-toggle="toggle" data-on="여론조사" data-off="우주의기운" data-onstyle="success" data-offstyle="danger" title="지지율 토글 버튼">
                    <button id="rating-graph-button" class="btn btn-info" data-toggle="modal" data-target="#rating-modal">그래프 보기</button>
                </div>
            </div>
            <div class="row">
                <div id="rating-template">
                {% include 'rating.html' %}
                </div>
            </div>
        </div>
    </section>

    <!-- Rating Modal -->
    <div id="rating-modal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">여론조사 지지율 차트</h4>
                </div>
                <div class="modal-body">
                    <div id="ratingChart"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
                </div>
            </div>
        </div>
    </div>

    <section id="pledge">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">공약 이상형</h2>
                    <h3 class="section-subheading text-muted">대선공약을 평가하고 자신에게 맞는 후보를 찾으세요</h3>
                </div>
            </div>
            <div class="row">
                <div id="pledge-test" class="text-center">
                    <button id="pledge-test-start-button" class="btn btn-primary">시작하기</button>
                </div>
            </div>
        </div>
    </section>

    <section id="lucky">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">럭키박스</h2>
                    <h3 class="section-subheading text-muted">이름점</h3>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 text-center">
                    <h4>이름점</h4>
                    <div class="input-group">
                        <input type="text" id="inputUserName" class="form-control" placeholder="내 이름 입력" maxlength="4">
                        <span class="input-group-btn">
                            <button type="button" class="btn btn-primary" id='buttonUserName'>확인</button>
                        </span>
                    </div>

                    <div class="demo"></div>
                </div>
                <div class="col-md-6 text-center">
                    <h4>별자리</h4>
                    <div class="col-md-2">&nbsp;</div>
                    <div class="col-md-8 input-group text-center">
                        <select class="form-control" id="constellation-month" title="월">
                            {% for i in "xxxxxxxxxxxx" %}
                            <option value="{{ forloop.counter }}">{{ forloop.counter }}월</option>
                            {% endfor %}
                        </select>
                        <span class="input-group-addon">-</span>
                        <select class="form-control col-xs-2" id="constellation-day" title="일">
                            {% for i in "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" %}
                            <option value="{{ forloop.counter }}">{{ forloop.counter }}일</option>
                            {% endfor %}
                        </select>
                        <span class="input-group-btn">
                            <button id="constellation-button" type="button" class="btn btn-default">확인</button>
                        </span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 text-center">
                    <h4>혈액형</h4>

                </div>
                <div class="col-md-6 text-center">
                    <h4>룰렛</h4>
                    <div class="roulette">
                        <img src="{% static 'img/candidate/moon.jpg' %}"/>
                        <img src="{% static 'img/candidate/ahn1.jpg' %}"/>
                        <img src="{% static 'img/candidate/ahn2.jpg' %}"/>
                        <img src="{% static 'img/candidate/hong.jpg' %}"/>
                        <img src="{% static 'img/candidate/hwang.jpg' %}"/>
                        <img src="{% static 'img/candidate/lee.jpg' %}"/>
                        <img src="{% static 'img/candidate/nam.jpg' %}"/>
                        <img src="{% static 'img/candidate/sim.jpg' %}"/>
                        <img src="{% static 'img/candidate/son.jpg' %}"/>
                        <img src="{% static 'img/candidate/you.jpg' %}"/>
                    </div>
                    <button id="roulette-start" type="button" class="btn btn-default">룰렛 돌리기</button>
                </div>
            </div>
        </div>
    </section>

    <!--TODO: 별자리 모달뷰 디자인-->
    <div id="constellation-result">
    </div>

    <section id="press">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">언론</h2>
                    <h3 class="section-subheading text-muted">키워드로 보는 대선후보 동향</h3>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 col-sm-6 text-center">
                    <h4>언론 언급 점유율</h4>
                    <div id="press-chart-pie"></div>
                </div>
                <div class="col-md-6 col-sm-6 text-center">
                    <h4>언론 언급 횟수</h4>
                    <div id="press-chart-line"></div>
                </div>
            </div>
        </div>
    </section>

    <section id="cheering">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">대선주자 응원하기</h2>
                    <h3 class="section-subheading text-muted">대선 주자들에게 응원메시지를 남기는 공간입니다</h3>
                </div>
            </div>
            <div class="row">
                <div class="input-group">
                    <select class="form-control" id="cheering-candidate" title="대선주자">
                        <option>문재인</option>
                        <option>안희정</option>
                        <option>황교안</option>
                        <option>안철수</option>
                        <option>남경필</option>
                        <option>유승민</option>
                        <option>이재명</option>
                        <option>심상정</option>
                    </select>
                    <span class="input-group-addon">@</span>
                    <input class="form-control" type="text" id="cheering-message" title="메세지">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button" id="post-cheering">등록</button>
                    </span>
                </div>
            </div>
            <div class="row">
                <table class="table table-condensed">
                    <tbody id="cheering-table">
                        {% include 'cheering_table.html' %}
                    </tbody>
                    <tfoot>
                        <tr><td colspan="4"><button id="cheering-more" class="btn btn-default btn-block">응원메세지 더보기</button></td></tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </section>

    <section id="donate">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <h2 class="section-heading">기부하기</h2>
                    <h3 class="section-subheading text-muted">대선후보/대선닷컴에 기부하세요</h3>
                </div>
            </div>
            <div class="row">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>후원 대상</th>
                            <th>후원 계좌</th>
                            <th>예금주</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>문재인</td>
                            <td>우리은행 1006-901-451607</td>
                            <td>문재인후원회</td>
                        </tr>
                        <tr>
                            <td>안희정</td>
                            <td>농협 301-0206-6146-11</td>
                            <td>김태영</td>
                        </tr>
                        <tr>
                            <td>이재명</td>
                            <td>농협 302-0207-1611-11</td>
                            <td>이재명후원회</td>
                        </tr>
                        <tr>
                            <td>대선닷컴</td>
                            <td>우리은행 계좌개설해야지</td>
                            <td>대선닷컴</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</body>


<script type="text/javascript" src="{% static 'js/cheering.js' %}"></script>
<script type="text/javascript" src="{% static 'js/lucky-name-test.js' %}"></script>
<script type="text/javascript" src="{% static 'js/main/wow.js' %}"></script>
<script type="text/javascript" src="{% static 'js/main/js.cookie.js' %}"></script>
<script type="text/javascript" src="{% static 'js/main/roulette.js' %}"></script>
<script type="text/javascript" src="{% static 'js/main/jquery.waypoints.js' %}"></script>

<script type="text/javascript">
new WOW().init();

function waitMe(element) {
    element.waitMe({
        effect : 'facebook',
        text : '로딩 중입니다',
        bg : 'rgba(255,255,255,0.7)',
        color : '#000',
        maxSize : '',
        textPos : 'vertical',
        fontSize : '',
        source : ''
    });
}

var csrftoken = Cookies.get('csrftoken');
function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
}
$.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
    }
});
</script>

<script type="text/javascript">
$(function() {
    var before = null;
    $('#rating-toggle').change(function() {
        var is_rating = $(this).prop('checked');
        var template = $('#rating-template');
        var temp;
        if (is_rating) {
            if (before != null) {
                temp = template.html();
                template.html(before);
                before = temp;
            }
        } else {
            if (before == null) {
                waitMe($('#rating'));
                $.ajax({
                    url: '/rating',
                    headers: {
                        'Content-Type':'application/json'
                    },
                    type: 'POST',
                    data: JSON.stringify({
                            'type': 'lucky'
                        }),
                    success: function(data) {
                        before = template.html();
                        template.html(data);
                        $('#rating').waitMe('hide');
                        page = 1;
                    },
                    error: function() {
                        alert('우주의기운 지지율을 가져오는데 실패하였습니다');
                        $('#rating').waitMe('hide');
                    }
                });
            } else {
                temp = template.html();
                template.html(before);
                before = temp;
            }
        }
    })
});

// 지지율 차트
var ratingChart = null;
$('#rating-graph-button').click(function() {
    if (ratingChart == null) {
        waitMe($('#rating-modal'));
        $.ajax({
            url: '/apis/rating',
            headers: {
                'Content-Type':'application/json'
            },
            async: true,
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                var result_list = [['x'], ['문재인'], ['안철수'], ['황교안'], ['남경필'], ['안희정'], ['이재명'], ['유승민']];
                for (var i = 0; i < data.length; i++) {
                    var obj = data[i];
                    if (!result_list[0].includes(obj.date)) {
                        result_list[0].push(obj.date);
                    }

                    switch (obj.candidate) {
                        case '문재인':
                            result_list[1].push(obj.rating);
                            break;
                        case '안철수':
                            result_list[2].push(obj.rating);
                            break;
                        case '황교안':
                            result_list[3].push(obj.rating);
                            break;
                        case '남경필':
                            result_list[4].push(obj.rating);
                            break;
                        case '안희정':
                            result_list[5].push(obj.rating);
                            break;
                        case '이재명':
                            result_list[6].push(obj.rating);
                            break;
                        case '유승민':
                            result_list[7].push(obj.rating);
                            break;
                    }
                }

                c3.generate({
                    bindto: '#ratingChart',
                    data: {
                        x: 'x',
                        columns: result_list
                    },
                    axis: {
                        x: {
                            type: 'timeseries',
                            tick: {
                                format: '%Y-%m-%d'
                            }
                        }
                    }
                });
                $('#rating-modal').waitMe('hide');
            },
            error: function(data, status, err) {
                console.log(err);
                $('#rating-modal').waitMe('hide');
            }
        });
    }
});
</script>

<script type="text/javascript">
    var blindResult;
    var blindToken;
    var blindList;
    var blindLoopIndex;

    $('#pledge-test-start-button').click(function () {
        console.log('pledge start');
        waitMe($('#pledge'));
        $.ajax({
            url: '/pledge',
            headers: {
                'Content-Type':'application/json'
            },
            type: 'GET',
            success: function(data) {
                $('#pledge-test').html(data);
                $.ajax({
                    url: '/apis/pledge',
                    headers: {
                        'Content-Type':'application/json'
                    },
                    dataType: 'json',
                    cache: false,
                    type: 'GET',
                    success: function(data) {
                        blindResult = [];
                        blindToken = data.token;
                        blindList = data.list;
                        blindLoopIndex = 1;

                        $('#pledge-test-title').html(blindList[0].title);
                        $('#pledge-test-contents').html(blindList[0].contents);
                        $('#pledge').waitMe('hide');
                    },
                    error: function(data, status, err) {
                        console.log(err);
                        $('#pledge').waitMe('hide');
                    }
                });
            },
            error: function(data, status, err) {
                console.log(err);
                $('#pledge').waitMe('hide');
            }
        });
    });

function blindNextButtonClick(button) {
    if (blindLoopIndex < 10) {
        $('#pledge-test-title').html(blindList[blindLoopIndex].title);
        $('#pledge-test-contents').html(blindList[blindLoopIndex].contents);
        blindLoopIndex += 1;
        blindResult.push(button.value);
    } else {
        waitMe($('#pledge'));
        blindLoopIndex += 1;
        blindResult.push(button.value);

        console.log(blindResult);
        $.ajax({
                url: '/pledge',
                cache: false,
                headers: {
                    'Content-Type':'application/json'
                },
                async: true,
                type: 'POST',
                data: JSON.stringify({
                    'token': blindToken,
                    'list': blindResult
                }),
                success: function(data) {
                    $('#pledge').waitMe('hide');
                    $('#pledge-test').html(data);
                },
                error: function(data, status, err) {
                    $('#pledge').waitMe('hide');
                    console.log(err);
                }
            });
    }
}
</script>

<script type="text/javascript">
    $('#constellation-button').click(function() {
        var month = $('#constellation-month').val();
        var day = $('#constellation-day').val();
        waitMe($('#lucky'));
        $.ajax({
                url: '/constellation',
                headers: {
                    'Content-Type':'application/json'
                },
                cache: false,
                type: 'POST',
                data: JSON.stringify({
                    'month': Number(month),
                    'day': Number(day)
                }),
                success: function(data) {
                    $('#constellation-result').html(data);
                    $('#constellation-modal').modal('show');
                    $('#lucky').waitMe('hide');
                },
                error: function(data, status, err) {
                    console.log(err);
                    $('#lucky').waitMe('hide');
                }
            });
    });
</script>

<script type="text/javascript">
    var option = {
        speed : 10,
        duration : 3,
        startCallback : function() {
            console.log('start');
        },
        slowDownCallback : function() {
            console.log('slowDown');
        },
        stopCallback : function($stopElm) {
            console.log('stop');
        }
    };
	var rouletter = $('div.roulette');
    rouletter.roulette(option);
	$('#roulette-start').click(function(){
		rouletter.roulette('start');
	});
</script>

<script type="text/javascript">
    var isLoadChart = false;
    $('#lucky').waypoint(function () {
        if (!isLoadChart) {
            createPressChart();
        }
    });
    $('#press').waypoint(function() {
        if (!isLoadChart) {
            createPressChart();
        }
    });
    $('#donate').waypoint(function() {
        if (!isLoadChart) {
            createPressChart();
        }
    });

    function createPressChart() {
        var count = 0;
        isLoadChart = true;
        waitMe($('#press'));
        $.ajax({
                url: '/apis/cp/group',
                headers: {
                    'Content-Type':'application/json'
                },
                cache: false,
                type: 'GET',
                success: function(data) {
                    var result = [['문재인', 0], ['이재명', 0], ['안희정', 0], ['유승민', 0], ['황교안', 0], ['안철수', 0], ['남경필', 0]];

                    for (var i = 0; i < data.length; i++) {
                        result[0][1] += data[i].moon;
                        result[1][1] += data[i].lee;
                        result[2][1] += data[i].hee;
                        result[3][1] += data[i].you;
                        result[4][1] += data[i].hwang;
                        result[5][1] += data[i].ahn;
                        result[6][1] += data[i].nam;
                    }

                    press_chart = c3.generate({
                        bindto: '#press-chart-pie',
                        data: {
                            columns: result,
                            type : 'pie'
                        }
                    });

                    if (count == 0) {
                        count++;
                    } else {
                        $('#press').waitMe('hide');
                    }
                },
                error: function(data, status, err) {
                    console.log(err);
                }
            });
        $.ajax({
                url: '/apis/cp/daily',
                headers: {
                    'Content-Type':'application/json'
                },
                cache: false,
                type: 'GET',
                success: function(data) {
                    var result_list = [['x'], ['문재인'], ['안철수'], ['황교안'], ['남경필'], ['안희정'], ['이재명'], ['유승민']];
                    for (var i = 0; i < data.length; i++) {
                        var obj = data[i];
                        result_list[0].push(obj.date);
                        result_list[1].push(obj.moon);
                        result_list[2].push(obj.ahn);
                        result_list[3].push(obj.hwang);
                        result_list[4].push(obj.nam);
                        result_list[5].push(obj.hee);
                        result_list[6].push(obj.lee);
                        result_list[7].push(obj.you);
                    }

                    c3.generate({
                        bindto: '#press-chart-line',
                        data: {
                            x: 'x',
                            columns: result_list
                        },
                        axis: {
                            x: {
                                type: 'timeseries',
                                tick: {
                                    format: '%Y-%m-%d'
                                }
                            }
                        }
                    });

                    if (count == 0) {
                        count++;
                    } else {
                        $('#press').waitMe('hide');
                    }
                },
                error: function(data, status, err) {
                    console.log(err);
                }
            });
    }
</script>

</html>